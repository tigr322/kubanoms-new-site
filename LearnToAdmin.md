# Руководство Администратора (CMS / Админка)

Это краткая инструкция для администраторов и редакторов сайта: как добавлять страницы, новости, документы, управлять меню и проверять результат на сайте.

## 1) Вход в админку

1. Откройте админку по адресу `/admin`.
2. Введите логин/пароль администратора.

Роли:
- `admin`: полный доступ.
- `editor`: доступ к контенту (зависит от настроек доступа на проекте).

## 2) Базовые правила публикации

Статусы страницы:
- **Черновик**: не виден посетителям.
- **На модерации**: не виден посетителям.
- **Опубликовано**: виден посетителям.

Важно:
- Посетители видят только **Опубликованные** страницы.
- Ссылки в меню на **неопубликованные** страницы автоматически скрываются (пункт останется, но ссылка станет недоступна).

## 3) Создание и редактирование страниц

Раздел: **Контент → Страницы**

Главные поля:
- **Title**: заголовок страницы.
- **URL страницы**: обязательный, должен начинаться с `/`.
  Примеры: `/press`, `/grazhd.html`, `/news/demo-news.html`.
- **Тип страницы**:
  - `Страница` (обычная)
  - `Новость`
  - `Документ`
  - `Карта сайта`
- **Шаблон (template)**: поле с подсказками (выпадающий список/автодополнение).
  Частые варианты: `default`, `home`, `news`, `document`, `sitemap`, `vr`.
- **Контент**: визуальный редактор (Rich Editor).
- **Фотографии** (для новостей): галерея на странице новости.
- **Документы (attachments)** (для новостей и документов): прикреплённые файлы под текстом.

Примечание:
- При выборе **Тип страницы** админка может автоматически подставить рекомендуемый **template** (например, для новости — `news`, для документа — `document`).

## 4) Иерархия страниц (родитель/дочерние)

В форме страницы есть поле **parent_id** (Родительская страница).

Используйте это, чтобы:
- строить правильную структуру разделов,
- логически группировать контент (например, новости могут быть “внутри” страницы “Пресс-центр”).

## 5) Меню сайта (горизонтальное/вертикальное) и вложенности

Раздел: **Контент → Меню**

Есть 3 меню:
- `NAVBAR` — горизонтальное меню (шапка).
- `SIDEBAR` — вертикальное меню (левая колонка).
- `CURRENT_INFORMATION` — “Актуальная информация” (правый блок).

### 5.1 Структура меню (дерево)

Откройте нужное меню → **Edit** → блок **Структура меню**.

Каждый пункт меню:
- **Название**
- **Показывать** (видимость)
- **Страница** (ссылка на страницу из CMS)
- **URL (если внешняя ссылка)** (для внешних адресов или специальных страниц)
- **Подпункты** (дочерние пункты меню)

### 5.2 Max depth (глубина)

Поле **Max depth** ограничивает глубину, которую сайт подгружает для меню.

Пример:
- `NAVBAR` = 2: Родители + 1 уровень дочерних.
- `SIDEBAR` = 3: Родители + 2 уровня дочерних.

### 5.3 Как это работает на сайте

Горизонтальное меню (NAVBAR):
- Родительские пункты — в шапке.
- При наведении на родителя показываются дочерние пункты (выпадающий список).
- При клике на родителя открывается его страница; если у пункта есть дочерние — на странице выводится “карта раздела” с дочерними ссылками.

Вертикальное меню (SIDEBAR):
- Пункты с дочерними раскрываются/сворачиваются в меню (как на старом сайте).

## 6) Новости: редактор, медиа, “версия для печати”

Раздел: **Контент → Страницы**

Чтобы создать новость:
1. Создайте страницу с **Тип страницы = Новость**.
2. Укажите `template = news`.
3. Заполните **контент**, при необходимости добавьте **фотографии** и **прикреплённые документы**.
4. Поставьте **Статус = Опубликовано**.

Версия для печати:
- На странице новости есть ссылка **“Версия для печати”**.
- Прямой адрес печатной версии: `/print{URL_страницы}`.

## 7) Документы: загрузка 10–100000 файлов и таблицы “как zakon9.html”

Есть два режима документов:
1. “Обычный документ”: контент + прикреплённые файлы (attachments) под текстом.
2. “Страница документов-таблиц”: много файлов (10–100000), вывод в виде таблицы с пагинацией и группами (таблицами).

Чтобы сделать страницу документов-таблиц:
1. Создайте страницу с **Тип страницы = Документ**, `template = document`.
2. Перейдите во вкладку **Документы** на странице редактирования (внутри страницы).
3. Загрузите файлы:
   - по одному через **Create**
   - или массово через кнопку **“Загрузить файлы”**

Поля для каждого документа:
- **Название**
- **Таблица** (group_title): группировка документов в “таблицы” (например: “2026 год”, “Приказы”, “Письма”).
- **Дата документа**
- **Порядок**
- **Видимость**

Как это выглядит на сайте:
- вкладки/переключатели групп (“таблиц”),
- таблица документов,
- пагинация (по 50 документов на страницу).

## 8) RSS-канал новостей

RSS доступен по адресу: `/rss.xml`.

Он формируется автоматически на основе опубликованных новостей (тип “Новость”).

## 9) Карта сайта

Карта сайта доступна:
- `/sitemap`
- `/sitemap.html`

Она строится по меню `NAVBAR`, `SIDEBAR`, `CURRENT_INFORMATION`.

## 10) Если изменения не видны (частые проблемы)

### 10.1 Админка не показывает новые поля/деревья
Иногда Filament кеширует компоненты.

Выполните:
```bash
php artisan filament:clear-cached-components
php artisan optimize:clear
```

### 10.2 На сайте не видно изменений фронтенда
Если изменения касаются страниц/компонентов Vue:
```bash
npm run build
```
или для разработки:
```bash
npm run dev
```

### 10.3 Файлы не открываются
Проверьте, что на сервере настроена публичная раздача `storage` (обычно нужен `php artisan storage:link` при первичной настройке).

## 11) Рекомендации по поддержанию порядка

- Для разделов используйте “родительские” страницы (parent_id), даже если URL исторически лежит в корне (`/polis.html`).
- Для документов-таблиц используйте **группы (Таблица)** и **Дату документа** — это делает навигацию удобной.
- Перед публикацией проверяйте:
  - страница открывается по URL,
  - пункты меню ведут на нужные страницы,
  - дочерние пункты раскрываются/видны.

